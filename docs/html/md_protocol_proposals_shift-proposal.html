<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Firmata library reference: shift in/out proposal</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="firmata-docs.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Firmata library reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_protocol_proposals_shift-proposal.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">shift in/out proposal </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are a few different ways to approach shift in/out support. It's complicated since different hardware handles shift in/out in different ways. For example, not all hardware requires a latch pin and those that use some sort of a latch don't always use it the same way.</p>
<p>There has also been some discussion around supporting fractional byte devices. The proposals below do not include such functionality. I'm not sure how popular such devices are. If someone has a proposal that includes support for shifting fractional bytes, please submit a pull request to add the proposal to this document.</p>
<h1><a class="anchor" id="autotoc_md77"></a>
Propoasl A: shift in/out with no config or latch support</h1>
<p>In this version it the user must configure the pin (input / output) separately. If the hardware they are using requires a latch, the latch pin must be managed separately.</p>
<div class="fragment"><div class="line">// shift out</div>
<div class="line">0  START_SYSEX</div>
<div class="line">1  SHIFT_DATA          (0x75)</div>
<div class="line">2  SHIFT_OUT           (0x01)</div>
<div class="line">3  dataPin</div>
<div class="line">4  clockPin</div>
<div class="line">5  bitOrder            (MSBFIRST or LSBFIRST)</div>
<div class="line">n ...                  (shift out data)</div>
<div class="line">n+1 END_SYSEX</div>
<div class="line"> </div>
<div class="line">// shift in (for client application to request shift-in data from microcontroller)</div>
<div class="line">0  START_SYSEX</div>
<div class="line">1  SHIFT_DATA          (0x75)</div>
<div class="line">2  SHIFT_IN            (0x02)</div>
<div class="line">3  dataPin</div>
<div class="line">4  clockPin</div>
<div class="line">5  bitOrder            (MSBFIRST or LSBFIRST)</div>
<div class="line">6  numBytes            (number of bytes to shift in. Default to 1)</div>
<div class="line">7 END_SYSEX</div>
<div class="line"> </div>
<div class="line">// shift in reply (for sending shift-in data to client application)</div>
<div class="line">0  START_SYSEX</div>
<div class="line">1  SHIFT_DATA          (0x75)</div>
<div class="line">2  SHIFT_IN_REPLY      (0x03)</div>
<div class="line">3  dataPin             (so you know which data pin the reply corresponds to)</div>
<div class="line">n ...                  (shift in data)</div>
<div class="line">n+1 END_SYSEX</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md78"></a>
Proposal B: shift in/out with config and latch support</h1>
<p>The advantages with this version over the one above is that pin modes are handled by the implementation (in the other version you have to handle them manually). You also send fewer bytes when shifting out or in data (since only have to specify clock, bitOrder and optional latch pin once when sending the config). The disadvantage is that memory must be allocated to store pin information.</p>
<p>Another advantage with this version is that you can rely on the firmware to do more of the work. For example you can shift in multiple bytes at a time and send them to the client in a single packet rather than a single byte at at time (if your hardware requires a latch/load pin).</p>
<p>This version uses a SHIFT_CONFIG command to set the clock pin, bitOrder and optional latchPin (or load for some shift-in hardware). There are a few different shift types / latch configurations:</p>
<div class="fragment"><div class="line">// shift types (specified in bits 3:5 of byte 2)</div>
<div class="line">SHIFT_OUT                     // shift out with no latch</div>
<div class="line">SHIFT_IN                      // shift out with no latch/load</div>
<div class="line">LATCH_L_SHIFT_OUT             // set latch low then shift out</div>
<div class="line">LATCH_L_SHIFT_OUT_LATCH_H     // set latch low, shift out, then set latch high</div>
<div class="line">SHIFT_OUT_LATCH_H             // shift out then set latch high</div>
<div class="line">TOGGLE_LOAD_SHIFT_IN          // toggle load pin low, then high and shift in</div>
</div><!-- fragment --><p>The protocol is as follows: </p><div class="fragment"><div class="line">// shift config (send when instantiating a new shift-based hardware module)</div>
<div class="line">0  START_SYSEX</div>
<div class="line">1  SHIFT_DATA    (0x75)</div>
<div class="line">2  SHIFT_CONFIG  (bits 0:2 shift command, bits 3:5 shift type, bit 6 unused)</div>
<div class="line">3  dataPin</div>
<div class="line">4  clockPin</div>
<div class="line">5  bitOrder</div>
<div class="line">6  latchPin      [optional]</div>
<div class="line">7 END_SYSEX</div>
<div class="line"> </div>
<div class="line">// shift out</div>
<div class="line">0  START_SYSEX</div>
<div class="line">1  SHIFT_DATA    (0x75)</div>
<div class="line">2  SHIFT_OUT     (bits 0:2 shift command, bits 3:5 shift type, bit 6 unused)</div>
<div class="line">3  dataPin</div>
<div class="line">n  ...           (shift out data)</div>
<div class="line">n+1 END_SYSEX</div>
<div class="line"> </div>
<div class="line">// shift in</div>
<div class="line">0  START_SYSEX</div>
<div class="line">1  SHIFT_DATA    (0x75)</div>
<div class="line">2  SHIFT_IN      (bits 0:2 shift command, bits 3:5 shift type, bit 6 unused)</div>
<div class="line">3  dataPin</div>
<div class="line">4  numBytes      (number of bytes to shift in. Default to 1)</div>
<div class="line">5  END_SYSEX</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
