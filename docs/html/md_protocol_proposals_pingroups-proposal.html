<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Firmata library reference: Digital Pin Groups (Proposal)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="firmata-docs.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Firmata library reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_protocol_proposals_pingroups-proposal.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Digital Pin Groups (Proposal) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Provides support for the situation where you want to set or get the values of an arbitrary set of digital IO pins that may not necessarily align to a port and do all of this in one operation.</p>
<p>Examples of this behaviour would include:</p>
<ul>
<li>Analog Multiplexer / Demultimplexer, where you need to set the bit value of three pins in order to determine which analog line is being used on the multiplexer.</li>
<li>Keypads where the value of the key presses are expressed using a combination of states across a set of digital lines (eg: <a href="https://www.sparkfun.com/products/8653">https://www.sparkfun.com/products/8653</a> )</li>
</ul>
<p>When you want to issue an equivalent of a digitalWrite to a group of pins, you'll then issue a sequence of 7-bit bytes that provides the states of the pins collectively. This will save several calls to digital write and allow them to be done in one group.</p>
<p>Reads will work the same way but return a byte with the states of all of the pins. This is particularly important in a scenario like a keypad where independent async reads can make it extremely challenging to get the state of the keypress properly.</p>
<h1><a class="anchor" id="autotoc_md37"></a>
Requirements</h1>
<ul>
<li>Currently unimplemented (PoC to come shortly)</li>
<li>An array of pin groups (suggest 8 groups so it can be identifed with 3 bits each with up to 14 pins defined in the group)</li>
<li>Modifications to firmata to accept the new protocol.</li>
</ul>
<h1><a class="anchor" id="autotoc_md38"></a>
Protocol</h1>
<h2><a class="anchor" id="autotoc_md39"></a>
Digital Pin Group commands</h2>
<p>In order to save space in the protocol, the Digital Pin Group command comprises both protocol commands as well as the id address space for the groups as below:</p>
<p>LSB 0 - 2: 3 bits to determine which Pin Group command is being issued 3 : Reserved for future use / address space increases 4 - 6: 3 bits for Pin Group ID address space - providing up to 8 distinct digital pin groups</p>
<p>Command values are provided below </p><div class="fragment"><div class="line">CONFIG              (0x00)</div>
<div class="line">CLEAR               (0x01)</div>
<div class="line">PIN_STATE_SET       (0x02)</div>
<div class="line">PIN_STATE_REQUEST   (0x03)</div>
<div class="line">PIN_STATE_REPLY     (0x04)</div>
<div class="line">future reserved     (0x05 - 0x07)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md40"></a>
Configuration</h2>
<p>Specifies which pins should be grouped together and in which order. A maximum of 14 pins can be grouped together in one pin group. When specified in the config message, the pins will be provided in little endian style so the first pin will then be configured to mapped to the Least Significant Bit in subsequent write and read messages.</p>
<div class="fragment"><div class="line">0:  START_SYSEX         (0xF0)</div>
<div class="line">1:  pin group command   (0x60)</div>
<div class="line">2:  pin group id (0 - 7) &lt;&lt; 4 | CONFIG</div>
<div class="line">3:  lowest bit set for pinMode (0=READ, 1=WRITE) top 6 bits reserved</div>
<div class="line">4:  first pin in pin group (0 - 127)</div>
<div class="line">5:  second pin in pin group (0 - 127)</div>
<div class="line">... up to maximum of 14</div>
<div class="line">N:  END_SYSEX           (0xF7)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
Clear</h2>
<p>Removes any pin entries associated to a pin group. This should free up any memory that has been allocted and remove any references to the pins that were configured. This is to ensure no side effects occur if a pin group is recycled.</p>
<div class="fragment"><div class="line">0:  START_SYSEX         (0xF0)</div>
<div class="line">1:  pin group command   (0x60)</div>
<div class="line">2:  pin group id (0 -7) &lt;&lt; 4 | CLEAR</div>
<div class="line">3:  END_SYSEX           (0xF7)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md42"></a>
State set</h2>
<p>Sets the states of the pins in the group. As noted above, the first pin that is supplied in the config will be considered the least significant bit in this message. Any values provided that don't match the config definition should simply be ignored (ie a value comes through for the 5th pin in the group but none was defined so it should be ignored).</p>
<div class="fragment"><div class="line">0:  START_SYSEX         (0xF0)</div>
<div class="line">1:  pin group command   (0x60)</div>
<div class="line">2:  pin group id (0 - 7) &lt;&lt; 4 | PIN_STATE_SET</div>
<div class="line">3:  packed 7 bit array as single byte providing values for the pin group</div>
<div class="line">... optional second packed 7 bit array providing values for the pin group</div>
<div class="line">N:  END_SYSEX           (0xF7)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
State request and reply</h2>
<p>Getting the states of the group of pins (essentially a group digital read) comprises a request to the board and a reply back.</p>
<p>Make a request for getting the states of the pin group.</p>
<div class="fragment"><div class="line">0:  START_SYSEX         (0xF0)</div>
<div class="line">1:  pin group command   (0x60)</div>
<div class="line">2:  pin group id (0 - 7) &lt;&lt; 4 | PIN_STATE_REQUEST</div>
<div class="line">3:  END_SYSEX</div>
</div><!-- fragment --><p>Reply with the pin states.</p>
<div class="fragment"><div class="line">0:  START_SYSEX         (0xF0)</div>
<div class="line">1:  pin group command   (0x60)</div>
<div class="line">2:  pin group id (0 - 7) &lt;&lt; 4 | PIN_STATE_REPLY</div>
<div class="line">3:  packed 7 bit array representing pin states, LSB is first pin defined in config</div>
<div class="line">... optional second 7 bit array representing pin states for additional pins in group</div>
<div class="line">N:  END_SYSEX</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
