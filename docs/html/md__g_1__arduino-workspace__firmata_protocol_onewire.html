<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Firmata library reference: OneWire</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="firmata-docs.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Firmata library reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__g_1__arduino-workspace__firmata_protocol_onewire.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OneWire </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The idea is to configure Arduino Pins as OneWire Busmaster. The may be more than one pin configured for OneWire and there may be more than one device connected to such a pin.</p>
<p>Each one-wire-device has a unique identifier which is 8 bytes long and comes factory-programmed into the the device. To scan all devices connected to a pin configured for onewire a SEARCH-request message is sent. The response contains all addresses of devices found. Having the address of a device OneWire-command-messages may be sent to this device.</p>
<p>The actual commands executed on the OneWire-bus are 'reset', 'skip', 'select', 'read', 'delay' and 'write' All these commands may be executed with a single OneWire-command-message. The subcommand-byte contains these commands bit-encoded. The data required to execute each bus-command must only be included in the message when the corresponding bit is set.</p>
<p>The order of execution of bus commands is: 'reset'-&gt;'skip'-&gt;'select'-&gt;'write'-&gt;'read'-&gt;'delay' (remember: each of these steps is optional. Also some combinations don't make sense and in fact are mutual exclusive in terms of OneWire bus protocol, so you cannot run a 'skip' followed by a 'select') The delay is useful for OneWire-commands included into taskdata (see <a href="https://github.com/firmata/protocol/blob/master/scheduler.md">Firmata-scheduler proposal</a>).</p>
<p>Some OneWire-devices require some time to carry out e.g. a a/d-conversion after receiving the appropriate command. Including a delay into a OneWire-message saves some bytes in the taskdata (in comparism to the inclusion of a 'delay_task' scheduler message). OneWire Read- and ReadReply messages are correlated using a correlationid (16bits). The reply contains the correlationid-value that was sent with the original request.</p>
<p>Added in Firmata protocol version 2.4.0.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Example files:</h2>
<ul>
<li>OneWire is include by default in <a href="https://github.com/firmata/ConfigurableFirmata/blob/master/examples/ConfigurableFirmata/ConfigurableFirmata.ino">ConfigurableFirmata.ino</a>.</li>
<li><a href="https://github.com/firmata/ConfigurableFirmata/blob/master/src/OneWireFirmata.cpp">Example implementation</a> as a configurable Firmata feature class.</li>
</ul>
<h2><a class="anchor" id="autotoc_md33"></a>
Compatible host implementations</h2>
<ul>
<li><a href="https://github.com/firmata/ConfigurableFirmata">ConfigurableFirmata</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md34"></a>
Compatible client librairies</h2>
<ul>
<li><a href="https://github.com/ntruchsess/perl-firmata">perl-firmata</a></li>
<li><a href="https://github.com/jgautier/firmata/blob/master/lib/firmata.js">node-firmata</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md35"></a>
Protocol details</h2>
<p>OneWire SEARCH request </p><div class="fragment"><div class="line">0  START_SYSEX      (0xF0)</div>
<div class="line">1  OneWire Command  (0x73)</div>
<div class="line">2  search command   (0x40|0x44) 0x40 normal search for all devices on the bus</div>
<div class="line">                                0x44 SEARCH_ALARMS request to find only those</div>
<div class="line">                                devices that are in alarmed state.</div>
<div class="line">3  pin              (0-127)</div>
<div class="line">4  END_SYSEX        (0xF7)</div>
</div><!-- fragment --><p>OneWire SEARCH reply </p><div class="fragment"><div class="line">0  START_SYSEX      (0xF0)</div>
<div class="line">1  OneWire Command  (0x73)</div>
<div class="line">2  search reply command (0x42|0x45) 0x42 normal search reply</div>
<div class="line">                                    0x45 reply to a SEARCH_ALARMS request</div>
<div class="line">3  pin              (0-127)</div>
<div class="line">4  bit 0-6   [optional] address bytes encoded using 8 times 7 bit for 7 bytes of 8 bit</div>
<div class="line">5  bit 7-13  [optional] 1.address[0] = byte[0]    + byte[1]&lt;&lt;7 &amp; 0x7F</div>
<div class="line">6  bit 14-20 [optional] 1.address[1] = byte[1]&gt;&gt;1 + byte[2]&lt;&lt;6 &amp; 0x7F</div>
<div class="line">7  ....                 ...</div>
<div class="line">11 bit 49-55            1.address[6] = byte[6]&gt;&gt;6 + byte[7]&lt;&lt;1 &amp; 0x7F</div>
<div class="line">12 bit 56-63            1.address[7] = byte[8]    + byte[9]&lt;&lt;7 &amp; 0x7F</div>
<div class="line">13 bit 64-69            2.address[0] = byte[9]&gt;&gt;1 + byte[10]&lt;&lt;6 &amp;0x7F</div>
<div class="line">n  ... as many bytes as needed (don&#39;t exceed MAX_DATA_BYTES though)</div>
<div class="line">n+1  END_SYSEX      (0xF7)</div>
</div><!-- fragment --><p>OneWire CONFIG request </p><div class="fragment"><div class="line">0  START_SYSEX      (0xF0)</div>
<div class="line">1  OneWire Command  (0x73)</div>
<div class="line">2  config command   (0x41)</div>
<div class="line">3  pin              (0-127)</div>
<div class="line">4  power            (0x00|0x01) 0x00 = leave pin on state high after write to support</div>
<div class="line">                                parasitic power</div>
<div class="line">                                0x01 = don&#39;t leave pin on high after write</div>
<div class="line">5  END_SYSEX (0xF7)</div>
</div><!-- fragment --><p>OneWire COMMAND request </p><div class="fragment"><div class="line">0  START_SYSEX      (0xF0)</div>
<div class="line">1  OneWire Command  (0x73)</div>
<div class="line">2  command bits     (0x00-0x2F) bit 0 = reset, bit 1 = skip, bit 2 = select,</div>
<div class="line">                                bit 3 = read, bit 4 = delay, bit 5 = write</div>
<div class="line">3  pin              (0-127)</div>
<div class="line">4  bit 0-6   [optional] data bytes encoded using 8 times 7 bit for 7 bytes of 8 bit</div>
<div class="line">5  bit 7-13  [optional] data[0] = byte[0]   + byte[1]&lt;&lt;7 &amp; 0x7F</div>
<div class="line">6  bit 14-20 [optional] data[1] = byte[1]&gt;1 + byte[2]&lt;&lt;6 &amp; 0x7F</div>
<div class="line">7  ....                 data[2] = byte = byte[2]&gt;2 + byte[3]&lt;&lt;5 &amp; 0x7F ...</div>
<div class="line">n  ... as many bytes as needed (don&#39;t exceed MAX_DATA_BYTES though)</div>
<div class="line">n+1  END_SYSEX      (0xF7)</div>
<div class="line"> </div>
<div class="line">// data bytes within OneWire Request Command message</div>
<div class="line">0  address[0]                    [optional, if bit 2 set]</div>
<div class="line">1  address[1]                              &quot;</div>
<div class="line">2  address[2]                              &quot;</div>
<div class="line">3  address[3]                              &quot;</div>
<div class="line">4  address[4]                              &quot;</div>
<div class="line">5  address[5]                              &quot;</div>
<div class="line">6  address[6]                              &quot;</div>
<div class="line">7  address[7]                              &quot;</div>
<div class="line">8  number of bytes to read (LSB) [optional, if bit 3 set]</div>
<div class="line">9  number of bytes to read (MSB)           &quot;</div>
<div class="line">10 request correlationid byte 0            &quot;</div>
<div class="line">11 request correlationid byte 1            &quot;</div>
<div class="line">10 delay in ms      (bits 0-7)   [optional, if bit 4 set]</div>
<div class="line">11 delay in ms      (bits 8-15)            &quot;</div>
<div class="line">12 delay in ms      (bits 16-23)           &quot;</div>
<div class="line">13 delay in ms      (bits 24-31)           &quot;</div>
<div class="line">14 data to write    (bits 0-7)   [optional, if bit 5 set]</div>
<div class="line">15 data to write    (bits 8-15)            &quot;</div>
<div class="line">16 data to write    (bits 16-23)           &quot;</div>
<div class="line">n  ... as many bytes as needed (don&#39;t exceed MAX_DATA_BYTES though)</div>
</div><!-- fragment --><p>OneWire READ reply </p><div class="fragment"><div class="line">0  START_SYSEX          (0xF0)</div>
<div class="line">1  OneWire Command      (0x73)</div>
<div class="line">2  read reply command   (0x43)</div>
<div class="line">3  pin                  (0-127)</div>
<div class="line">4  bit 0-6   [optional] data bytes encoded using 8 times 7 bit for 7 bytes of 8 bit</div>
<div class="line">5  bit 7-13  [optional] correlationid[0] = byte[0]   + byte[1]&lt;&lt;7 &amp; 0x7F</div>
<div class="line">6  bit 14-20 [optional] correlationid[1] = byte[1]&gt;1 + byte[2]&lt;&lt;6 &amp; 0x7F</div>
<div class="line">7  bit 21-27 [optional] data[0] = byte[2]&gt;2 + byte[3]&lt;&lt;5 &amp; 0x7F</div>
<div class="line">8  ....                 data[1] = byte[3]&gt;3 + byte[4]&lt;&lt;4 &amp; 0x7F</div>
<div class="line">n  ... as many bytes as needed (don&#39;t exceed MAX_DATA_BYTES though)</div>
<div class="line">n+1  END_SYSEX          (0xF7)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
